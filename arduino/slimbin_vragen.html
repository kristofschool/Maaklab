<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Arduino HX711 Wetenschappelijk Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --primary: #2c3e50; --secondary: #3498db; --success: #27ae60; --danger: #e74c3c; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--primary); margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .screen { display: none; }
        .active { display: block; }
        h1, h2 { color: var(--secondary); text-align: center; }
        .vocab-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0; background: #f9f9f9; padding: 20px; border-radius: 10px; }
        .vocab-item b { color: var(--secondary); }
        input[type="text"] { width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #ddd; border-radius: 8px; font-size: 1em; }
        #stats-bar { display: flex; justify-content: space-between; padding: 10px; background: #eee; border-radius: 8px; margin-bottom: 20px; font-weight: bold; }
        .option { background: #f0f2f5; padding: 15px; margin: 10px 0; border-radius: 8px; cursor: pointer; transition: 0.2s; border-left: 5px solid transparent; }
        .option:hover { background: #e2e6ea; border-left-color: var(--secondary); }
        .feedback { padding: 15px; border-radius: 8px; margin-top: 15px; display: none; font-weight: bold; }
        .correct { background: #d4edda; color: #155724; }
        .wrong { background: #f8d7da; color: #721c24; }
        button { background: var(--secondary); color: white; border: none; padding: 15px 30px; border-radius: 8px; cursor: pointer; font-size: 1em; display: block; margin: 20px auto; width: 100%; }
        button:hover { opacity: 0.9; }
        .btn-report { background: var(--success); }
    </style>
</head>
<body>

<div class="container">
    <div id="screen-start" class="screen active">
        <h1>Arduino Project: Deel 1</h1>
        <p>Welkom bij het wetenschappelijk dashboard. Voer je naam in om te beginnen.</p>
        <input type="text" id="user-name" placeholder="Naam van de groep/leerling...">
        
        <h3>üìñ Woordenlijst: Wat moet je weten?</h3>
        <div class="vocab-grid">
            <div class="vocab-item"><b>Bit:</b> De kleinste eenheid van informatie.</div>
            <div class="vocab-item"><b>Baudrate:</b> Snelheid van communicatie.</div>
            <div class="vocab-item"><b>ADC:</b> Analoog-naar-Digitaal Converter.</div>
            <div class="vocab-item"><b>Tare:</b> De nulinstelling.</div>
            <div class="vocab-item"><b>Float:</b> Getal met een komma.</div>
            <div class="vocab-item"><b>Calibration Factor:</b> Omzetgetal naar grammen.</div>
        </div>
        <button onclick="startApp()">Start de Code-Check</button>
    </div>

    <div id="screen-quiz" class="screen">
        <div id="stats-bar">
            <span>Gebruiker: <span id="display-name"></span></span>
            <span>Sterren: <span id="star-count">0</span> ‚≠ê</span>
            <span>Vraag: <span id="progress">1</span>/10</span>
        </div>
        <div id="question-area">
            <div id="question-text" style="font-size: 1.2em; margin-bottom: 20px;"></div>
            <div id="options-container"></div>
            <div id="feedback-box" class="feedback"></div>
        </div>
        <button id="btn-next" style="display:none;" onclick="nextQuestion()">Volgende Vraag</button>
    </div>

    <div id="screen-result" class="screen">
        <h2>Onderzoek Voltooid</h2>
        <div id="result-summary" style="text-align: center; font-size: 1.2em; margin: 20px 0;"></div>
        <button onclick="location.reload()">Doe de test opnieuw</button>
        <button class="btn-report" onclick="generatePDF()">Genereer Wetenschappelijk Rapport (PDF)</button>
    </div>
</div>

<script>
const { jsPDF } = window.jspdf;
let questionBank = [];
let userName = "";
let currentQuestions = [];
let currentIndex = 0;
let stars = 0;
let sessionLog = [];

async function startApp() {
    userName = document.getElementById('user-name').value;
    if(!userName) { alert("Geef eerst je naam in!"); return; }

    try {
        // Laad de vragen uit het JSON bestand
        const response = await fetch('questions.json');
        questionBank = await response.json();
        
        document.getElementById('display-name').innerText = userName;
        showScreen('screen-quiz');
        
        currentQuestions = questionBank.sort(() => 0.5 - Math.random()).slice(0, 10);
        currentIndex = 0;
        stars = 0;
        sessionLog = [];
        showQuestion();
    } catch (error) {
        console.error("Fout bij laden vragen:", error);
        alert("Kon de vragen niet laden. Zorg dat questions.json in dezelfde map staat.");
    }
}

function showQuestion() {
    const q = currentQuestions[currentIndex];
    document.getElementById('progress').innerText = currentIndex + 1;
    document.getElementById('question-text').innerText = q.q;
    document.getElementById('feedback-box').style.display = 'none';
    document.getElementById('btn-next').style.display = 'none';
    
    const container = document.getElementById('options-container');
    container.innerHTML = "";
    
    q.options.forEach((opt, i) => {
        const div = document.createElement('div');
        div.className = 'option';
        div.innerText = opt;
        div.onclick = () => checkAnswer(i);
        container.appendChild(div);
    });
}

function checkAnswer(choice) {
    const q = currentQuestions[currentIndex];
    const fb = document.getElementById('feedback-box');
    const isCorrect = (choice === q.correct);
    
    let key = `hist_${userName}_${q.q}`;
    let previousResult = localStorage.getItem(key);
    let reportNote = "";

    if(previousResult === "correct" && !isCorrect) {
        reportNote = "‚ö†Ô∏è WAARSCHUWING: Je wist dit de vorige keer wel!";
    } else if(previousResult === "wrong" && isCorrect) {
        reportNote = "‚úÖ VOORUITGANG: Verbeterd t.o.v. vorige keer.";
    }

    fb.style.display = 'block';
    if(isCorrect) {
        fb.className = "feedback correct";
        fb.innerText = "Correct! " + reportNote;
        stars++;
        localStorage.setItem(key, "correct");
    } else {
        fb.className = "feedback wrong";
        fb.innerText = "Fout. Juiste antwoord: " + q.options[q.correct];
        stars = Math.max(0, stars - 0.5);
        localStorage.setItem(key, "wrong");
    }
    
    sessionLog.push({ q: q.q, result: isCorrect ? "Juist" : "Fout", note: reportNote });
    document.getElementById('star-count').innerText = stars;
    document.getElementById('btn-next').style.display = 'block';
    if(currentIndex === 9) document.getElementById('btn-next').innerText = "Rapport Bekijken";
}

function nextQuestion() {
    currentIndex++;
    if(currentIndex < 10) showQuestion();
    else finishQuiz();
}

function finishQuiz() {
    showScreen('screen-result');
    document.getElementById('result-summary').innerText = `Totaal: ${stars} / 10 sterren.`;
}

function showScreen(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
}

function generatePDF() {
    const doc = new jsPDF();
    doc.text("WETENSCHAPPELIJK RAPPORT", 20, 20);
    doc.text(`Onderzoeker: ${userName}`, 20, 35);
    doc.text(`Score: ${stars} / 10`, 20, 45);
    let y = 60;
    sessionLog.forEach((item, i) => {
        doc.text(`${i+1}. ${item.result}: ${item.q.substring(0, 50)}...`, 20, y);
        y += 10;
        if(y > 270) { doc.addPage(); y = 20; }
    });
    doc.save(`Rapport_${userName}.pdf`);
}
</script>
</body>
</html>
