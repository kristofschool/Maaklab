<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arduino HX711 Quiz Expert</title>
    <style>
        :root {
            --primary: #00979D; /* Arduino Teal */
            --secondary: #006468;
            --accent: #E47128;
            --bg: #f4f4f9;
            --white: #ffffff;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        #quiz-container {
            background: var(--white);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 600px;
            text-align: center;
        }

        .screen { display: none; }
        .active { display: block; }

        h1 { color: var(--primary); margin-bottom: 1.5rem; }
        
        select, input {
            padding: 12px;
            width: 80%;
            margin: 10px 0;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
        }

        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.3s;
            margin-top: 10px;
        }

        button:hover { background-color: var(--secondary); }

        .option-btn {
            display: block;
            width: 100%;
            text-align: left;
            background: #f8f9fa;
            color: #333;
            border: 2px solid #eee;
            margin: 8px 0;
            padding: 15px;
        }

        .option-btn:hover {
            background: #e9ecef;
            border-color: var(--primary);
        }

        .progress-bar {
            height: 10px;
            background: #eee;
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }

        #progress-fill {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.3s;
        }

        .feedback {
            font-weight: bold;
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
        }

        .correct { background: #d4edda; color: #155724; }
        .wrong { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>

<div id="quiz-container">
    <div id="screen-start" class="screen active">
        <h1>Arduino Quizz</h1>
        <p>Voer je naam in en kies een fiche om te starten:</p>
        <input type="text" id="user-name" placeholder="Je naam...">
        <br>
        <select id="fiche-select">
            <option value="all">Alle beschikbare fiches</option>
            <option value="0" selected>Fiche 0: Hardware & Basis</option>
            <option value="1">Fiche 1: (Binnenkort)</option>
        </select>
        <br>
        <button onclick="initQuiz()">Start Quiz</button>
    </div>

    <div id="screen-quiz" class="screen">
        <div class="progress-bar"><div id="progress-fill"></div></div>
        <div id="level-display" style="font-size: 0.8rem; color: #666;"></div>
        <h3 id="question-text">Vraag tekst komt hier...</h3>
        <div id="options-container"></div>
        <div id="feedback" class="feedback" style="display: none;"></div>
        <button id="next-btn" style="display: none;" onclick="nextQuestion()">Volgende vraag</button>
    </div>

    <div id="screen-result" class="screen">
        <h1>Resultaat</h1>
        <p id="result-text"></p>
        <button onclick="location.reload()">Opnieuw proberen</button>
    </div>
</div>

<script>
    let questionBank = [];
    let currentFilteredQuestions = [];
    let currentQuestionIndex = 0;
    let score = 0;

    // Haal de vragen op uit de JSON (of gebruik de variabele als je lokaal test)
    async function loadQuestions() {
        try {
            const response = await fetch('questions.json');
            questionBank = await response.json();
        } catch (e) {
            console.error("Kon JSON niet laden, zorg dat questions.json in dezelfde map staat.");
            // Fallback voor testen:
            questionBank = [
                { "q": "Wat is de functie van de HX711 module?", "options": ["Het versterken van minieme signalen van de loadcell", "Het direct omzetten van digitale signalen naar mechanische druk", "Het aansturen van de seriÃ«le monitor voor een hogere verversingssnelheid", "Het stabiliseren van de voedingsspanning voor de Arduino Nano batterij"], "correct": 0, "level": 1, "fiche": 0 }
                // Voeg hier meer toe voor lokale tests zonder server
            ];
        }
    }

    async function initQuiz() {
        const name = document.getElementById('user-name').value;
        const selectedFiche = document.getElementById('fiche-select').value;

        if (!name) {
            alert("Vul eerst je naam in!");
            return;
        }

        await loadQuestions();

        // Filteren op fiche
        if (selectedFiche === "all") {
            currentFilteredQuestions = [...questionBank];
        } else {
            currentFilteredQuestions = questionBank.filter(q => q.fiche == selectedFiche);
        }

        // Shuffle de vragenlijst zelf ook
        currentFilteredQuestions.sort(() => Math.random() - 0.5);

        if (currentFilteredQuestions.length === 0) {
            alert("Geen vragen gevonden voor deze fiche.");
            return;
        }

        // 3. VOEG DIT TOE: Pak alleen de eerste 10 vragen van de geschudde lijst
        currentFilteredQuestions = currentFilteredQuestions.slice(0, 10);

        document.getElementById('screen-start').classList.remove('active');
        document.getElementById('screen-quiz').classList.add('active');
        showQuestion();
    }

    function showQuestion() {
        const feedbackEl = document.getElementById('feedback');
        const nextBtn = document.getElementById('next-btn');
        feedbackEl.style.display = 'none';
        nextBtn.style.display = 'none';

        const qData = currentFilteredQuestions[currentQuestionIndex];
        document.getElementById('question-text').innerText = qData.q;
        document.getElementById('level-display').innerText = `Level: ${qData.level} | Fiche: ${qData.fiche}`;
        
        const optionsContainer = document.getElementById('options-container');
        optionsContainer.innerHTML = '';

        // Maak een array van objecten om te kunnen shuffelen terwijl we de index onthouden
        let optionsMap = qData.options.map((opt, index) => {
            return { text: opt, isCorrect: index === qData.correct };
        });

        // Shuffle de opties zodat de langste niet altijd op dezelfde plek staat
        optionsMap.sort(() => Math.random() - 0.5);

        optionsMap.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt.text;
            btn.onclick = () => checkAnswer(opt.isCorrect, btn);
            optionsContainer.appendChild(btn);
        });

        updateProgress();
    }

    function checkAnswer(isCorrect, selectedBtn) {
        const options = document.querySelectorAll('.option-btn');
        options.forEach(btn => btn.disabled = true);

        const feedbackEl = document.getElementById('feedback');
        if (isCorrect) {
            score++;
            selectedBtn.style.borderColor = "#28a745";
            selectedBtn.style.background = "#d4edda";
            feedbackEl.innerText = "Correct! Goed gedaan.";
            feedbackEl.className = "feedback correct";
        } else {
            selectedBtn.style.borderColor = "#dc3545";
            selectedBtn.style.background = "#f8d7da";
            feedbackEl.innerText = "Helaas, dat is niet juist.";
            feedbackEl.className = "feedback wrong";
        }

        feedbackEl.style.display = 'block';
        document.getElementById('next-btn').style.display = 'inline-block';
    }

    function nextQuestion() {
        currentQuestionIndex++;
        if (currentQuestionIndex < currentFilteredQuestions.length) {
            showQuestion();
        } else {
            showResult();
        }
    }

    function updateProgress() {
        const progress = (currentQuestionIndex / currentFilteredQuestions.length) * 100;
        document.getElementById('progress-fill').style.width = progress + "%";
    }
    function verzendResultaatNaarGoogle(naam, score, totaal, fiche) {
    const scriptURL = "https://script.google.com/macros/s/AKfycbxgp5avoxk8D1cTCzarRMnyU6ETW6gpQWY22LwUX1NYEcwYfJg-xX00OtEH-bEV1KY2BA/exec";
    fetch(scriptURL, {
        method: 'POST',
        // We sturen de data als tekst omdat Google Scripts geen directe JSON-headers accepteert vanaf andere domeinen
        body: JSON.stringify({
            "naam": naam,
            "score": score,
            "totaal": totaal,
            "fiche": fiche
        })
    })
    .then(response => console.log('Data verzonden!'))
    .catch(error => console.error('Fout bij verzenden:', error));
}
   function showResult() {
    try {
        const name = document.getElementById('user-name').value;
        const totalQuestions = currentFilteredQuestions.length;
        const selectedFiche = document.getElementById('fiche-select').value;
        const percentage = Math.round((score / totalQuestions) * 100);
        
        // Update de tekst op het scherm
        document.getElementById('result-text').innerHTML = 
            `<strong>${name}</strong>, je hebt de quiz voltooid!<br><br>` +
            `Score: ${score} van de ${totalQuestions}<br>` +
            `Percentage: ${percentage}%`;

        // Wissel van scherm
        document.getElementById('screen-quiz').classList.remove('active');
        document.getElementById('screen-result').classList.add('active');

        // Stuur data naar Google (we wachten niet op antwoord, zodat de gebruiker door kan)
        verzendResultaatNaarGoogle(name, score, totalQuestions, selectedFiche);
        
    } catch (e) {
        console.error("Fout in showResult:", e);
        // Zorg dat de leerling in ieder geval zijn resultaat ziet, zelfs bij een bug
        document.getElementById('screen-quiz').classList.remove('active');
        document.getElementById('screen-result').classList.add('active');
    }
}
    
</script>

</body>
</html>
